<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/a.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/a.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Consolas:300,300italic,400,400italic,700,700italic|Times New Roman:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ll1ng.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;ensp;蕾姆，终于小小地填了点坑">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6.828-lab1">
<meta property="og:url" content="http://ll1ng.github.io/2022/05/06/MIT6-828-lab1/index.html">
<meta property="og:site_name" content="here&#39;s ling&#39;s blog">
<meta property="og:description" content="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;ensp;蕾姆，终于小小地填了点坑">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-06T15:21:28.000Z">
<meta property="article:modified_time" content="2022-05-06T15:21:28.000Z">
<meta property="article:author" content="ling">
<meta property="article:tag" content="os">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://ll1ng.github.io/2022/05/06/MIT6-828-lab1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MIT6.828-lab1 | here's ling's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="here's ling's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">here's ling's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">月が绮丽ですね</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">11</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ll1ng.github.io/2022/05/06/MIT6-828-lab1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E7%A9%B9.jpg">
      <meta itemprop="name" content="ling">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="here's ling's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MIT6.828-lab1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-06 23:21:28" itemprop="dateCreated datePublished" datetime="2022-05-06T23:21:28+08:00">2022-05-06</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;蕾姆，终于小小地填了点坑</p>
<span id="more"></span>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;这课B站上没找到很合适的视频，就直接跟着<a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2018/labs/lab1/">文档</a>走了。这篇记一下自己不熟悉的知识点和没搞懂的地方。</p>
<h1 id="Part-1-PC-Bootstrap"><a href="#Part-1-PC-Bootstrap" class="headerlink" title="Part 1: PC Bootstrap"></a>Part 1: PC Bootstrap</h1><p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;汇编器<code>NASM</code>使用的是<code>intel</code>语法，<code>GNU</code>使用的是<code>AT&amp;T</code>语法。本实验使用<code>GNU</code>。</p>
<h2 id="The-PC’s-Physical-Address-Space"><a href="#The-PC’s-Physical-Address-Space" class="headerlink" title="The PC’s Physical Address Space"></a>The PC’s Physical Address Space</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+------------------+  &lt;- 0xFFFFFFFF (4GB)</span><br><span class="line">|      32-bit      |</span><br><span class="line">|  memory mapped   |</span><br><span class="line">|     devices      |</span><br><span class="line">|                  |</span><br><span class="line">/\/\/\/\/\/\/\/\/\/\</span><br><span class="line"></span><br><span class="line">/\/\/\/\/\/\/\/\/\/\</span><br><span class="line">|                  |</span><br><span class="line">|      Unused      |</span><br><span class="line">|                  |</span><br><span class="line">+------------------+  &lt;- depends on amount of RAM</span><br><span class="line">|                  |</span><br><span class="line">|                  |</span><br><span class="line">| Extended Memory  |</span><br><span class="line">|                  |</span><br><span class="line">|                  |</span><br><span class="line">+------------------+  &lt;- 0x00100000 (1MB)</span><br><span class="line">|     BIOS ROM     |</span><br><span class="line">+------------------+  &lt;- 0x000F0000 (960KB)</span><br><span class="line">|  16-bit devices, |</span><br><span class="line">|  expansion ROMs  |</span><br><span class="line">+------------------+  &lt;- 0x000C0000 (768KB)</span><br><span class="line">|   VGA Display    |</span><br><span class="line">+------------------+  &lt;- 0x000A0000 (640KB)</span><br><span class="line">|                  |</span><br><span class="line">|    Low Memory    |</span><br><span class="line">|                  |</span><br><span class="line">+------------------+  &lt;- 0x00000000</span><br></pre></td></tr></table></figure>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>BIOS</code>一开始存放在真正的只读存储器中，现在则存放在可刷新的闪存中。<code>BIOS</code>用来实现基本的系统初始化，如激活显卡、检查安装的内存。初始化完成后，<code>BIOS</code>从正确的设备（如软盘、硬盘、CD-ROM或网络）中加载操作系统，并将执行权限交给操作系统。</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>IBM PC</code>从物理地址<code>0x000ffff0</code>开始执行，这是<code>BIOS区</code>相当高的一个地址，此处存放了一条指令：<code>ljmp   $0xf000,$0xe05b</code>，设置了<code>CS IP</code>。这样设计的目的是使<code>BIOS</code>永远在开机或重启后先得到机器的控制权（啊？）。</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;当<code>BIOS</code>运行时，建立一个中断描述符表，初始化如<code>VGA display</code>（视频图形阵列 显示？）在内的不同的设备。这就是<code>QEMU</code>窗口中可以看到字符的原因。当初始化完<code>PCI bus</code>和所有<code>BIOS</code>知道的重要设备后，它找到一个可引导的设备如软盘、硬盘、CD-ROM。找到后<code>BIOS</code>将<code>boot loader</code>从硬盘中读出，并将控制权交给它。</p>
<h1 id="Part2-The-Boot-Loader"><a href="#Part2-The-Boot-Loader" class="headerlink" title="Part2: The Boot Loader"></a>Part2: The Boot Loader</h1><p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;如果一个硬盘是可引导的，那么称它的第一个扇区为引导扇区，也就是<code>boot loader</code>所在的位置。当<code>BIOS</code>找到一个可引导设备时，它将这个引导扇区加载入物理地址为<code>0x7c00~0x7dff</code>的内存中，然后用<code>jmp</code>设置<code>CS IP</code>，将控制权交给<code>boot loader</code>。<code>BIOS</code>加载地址是相对任意的（？），而对PC来说这些地址是固定且标准化的。从CD-ROM中引导的能力是在PC开始发展很久以后才出现的，CD-ROM扇区大小为2048，能加载大得多的引导镜像。本实验使用的是传统硬件驱动引导机制。<code>boot loader</code>包括一个汇编语言源文件<code>boot/boot.S</code>和一个C源文件<code>boot/main.c</code>。</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>boot loader</code>的功能应包括：</p>
<ul>
<li>将处理器从实模式转换到32位保护模式，因为只有在这种模式下才能访问1MB空间的内存。</li>
<li>从硬盘里读取内核来通过x86特殊的IO指令直接访问IDE硬盘设备（啥？）寄存器。</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>obj/kern/kernel.asm</code>文件是<code>JOS kernel</code>的反汇编文件。</p>
<p><strong>Exercise 3.</strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;在0x7c00处下断点，执行到此处后对照<code>boot/boot.S</code>和 <code>obj/boot/boot.asm</code> 调试。回答以下问题。</p>
<ul>
<li>At what point does the processor start executing 32-bit code? What exactly causes the switch from 16- to 32-bit mode?</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;（这个不知道问的是保护模式还是32位模式就行）第一次跟的时候没在0x7c00处下断点，从头跟到这句以为就进了。可以看到此时地址是<code>0xfd781</code>故还在<code>BIOS</code>中，而这里我们学习的是<code>boot loader</code>所以应该不是这儿233。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[f000:d187]    0xfd187:	ljmpl  <span class="variable">$0x8</span>,<span class="variable">$0xfd18f</span></span><br><span class="line">0x0000d187 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) </span><br><span class="line">The target architecture is assumed to be i386</span><br><span class="line">=&gt; 0xfd18f:	mov    <span class="variable">$0x10</span>,%eax</span><br><span class="line">0x000fd18f <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;下方是想提问的地方。程序加载全局描述符表，取<code>cr0</code>原始值，将值最后一位置1，赋给<code>cr0</code>，最后<code>ljmp   $PROT_MODE_CSEG, $protcseg</code>跳转到32位代码段，程序进入保护模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[   0:7c1e] =&gt; 0x7c1e:	lgdtw  0x7c64</span><br><span class="line">0x00007c1e <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) </span><br><span class="line">[   0:7c23] =&gt; 0x7c23:	mov    %cr0,%eax</span><br><span class="line">0x00007c23 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) </span><br><span class="line">[   0:7c26] =&gt; 0x7c26:	or     <span class="variable">$0x1</span>,%eax</span><br><span class="line">0x00007c26 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) p/x <span class="variable">$cr0</span></span><br><span class="line"><span class="variable">$1</span> = 0x0</span><br><span class="line">(gdb) si</span><br><span class="line">[   0:7c2a] =&gt; 0x7c2a:	mov    %eax,%cr0</span><br><span class="line">0x00007c2a <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) </span><br><span class="line">[   0:7c2d] =&gt; 0x7c2d:	ljmp   <span class="variable">$0x8</span>,<span class="variable">$0x7c32</span></span><br><span class="line">0x00007c2d <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">The target architecture is assumed to be i386</span><br><span class="line">=&gt; 0x7c32:	mov    <span class="variable">$0x10</span>,%ax</span><br><span class="line">0x00007c32 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>lgdt</code>指令在实模式保护模式下都可以执行</p>
<p><code>CR0</code>是处理器内部的控制寄存器，包含了用于控制处理器操作模式和运行状态的标志位。32位，第1位是保护模式允许位PE</p>
</blockquote>
<ul>
<li>What is the <em>last</em> instruction of the boot loader executed, and what is the <em>first</em> instruction of the kernel it just loaded?</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;对比<code>main.c</code>和自<code>0x7c00</code>起始的反汇编指令，得到最后一条指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x7d7f:	jmp    0x7d66</span><br><span class="line">0x7d81:	call   *0x10018      &lt;---</span><br><span class="line">;((void (*)(void)) (ELFHDR-&gt;e_entry))();</span><br><span class="line">0x7d87:	mov    $0x8a00,%edx</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Continuing.</span><br><span class="line">=&gt; 0x7d81:	call   *0x10018</span><br><span class="line">Breakpoint 4, 0x00007d81 in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">=&gt; 0x10000c:	movw   $0x1234,0x472  &lt;--kernel第一条指令</span><br><span class="line">0x0010000c in ?? ()</span><br></pre></td></tr></table></figure>

<ul>
<li>How does the boot loader decide how many sectors it must read in order to fetch the entire kernel from disk? Where does it find this information?</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>bootmain</code>首先从磁盘上读取8个扇区大小的数据载入<code>0x10000</code>处，检测到载入的是一个合法的ELF文件后，取ELF结构体成员段表偏移<code>ELFHDR-&gt;e_phoff</code>+文件起始地址为第一个段表所在位置，段表个数由成员<code>e_phnum</code>得知。遍历每一个段表，根据段表结构体<code>Proghdr</code>成员<code>p_offset</code>,<code>p_memsz</code>,<code>p_pa</code>将每个段载入各自对应的位置。这里猜测不直接将所有段一起载入是为了节约空间。</p>
<h2 id="Loading-the-Kernel"><a href="#Loading-the-Kernel" class="headerlink" title="Loading the Kernel"></a>Loading the Kernel</h2><p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>VMA</code>和<code>LMA</code>。<code>VMA</code>，或虚拟地址，运行时才会有；<code>LMA</code>，或加载地址，加载时使用。链接器对二进制文件中的链接地址进行不同的处理，如当程序需要一个全局变量的地址时，如果是从未经链接的地址开始执行，二进制文件就不能正常工作。（不需要就可以正常执行？这句话属实不懂，链接地址又是个啥）生成这种不引用任何绝对地址的位置无关代码的技术已存在，且为现代共享库广泛使用，但它存在性能和复杂性上的开销，所以本实验中不用。也就是说，在本实验中段的<code>VMA</code>和<code>LMA</code>相同。</p>
<blockquote>
<p><strong>链接</strong>：将各种代码和数据片段收集并组合成一个单一文件的过程，这个文件可被加载到内存并执行。链接可以执行与编译时（源代码-&gt;机器代码）、加载时（程序被加载器<code>loader</code>加载到内存并执行时）、甚至运行时（由应用程序执行）。</p>
<p><strong>加载</strong>：将磁盘中的指令和数据载入内存中并运行的过程。</p>
<p><a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs/ld/Basic-Script-Concepts.html#Basic-Script-Concepts">linker文档</a>中提到，大部分时候两个地址都是相同的，一种二者可能不同的例子是数据段被加载到ROM中，当程序启动时又被复制到RAM中（这种技术常被用来在基于ROM的系统中初始化全局变量）</p>
<p>PS1：原文档翻译过来是<code>VMA</code>，或链接地址，加载到内存中的地址；<code>LMA</code>，或加载地址，这个段应该被载入内存中的地址。我就想问问<code>VMA LMA</code>这俩描述有啥区别？？</p>
<p>PS2：为避免“链接”的概念混淆，上述链接替换为虚拟，特指运行时地址。</p>
</blockquote>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>ELF</code>对象中需要被加载入内存的部分被标记为<code>LOAD</code>，<code>ph-&gt;p_pa</code>字段是段的物理地址</p>
<p><strong>Exercise 5</strong> 通过给 <code>boot/Makefrag</code>中的链接器传递 <code>-Ttext 0x7C00</code>来设置链接地址，这样程序才能正常执行。现改变<code>0x7c00</code>看程序如何崩溃。</p>
<p>【原因不会讲】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[   0:7c2d] =&gt; 0x7c2d:	ljmp   $0x8,$0x6c32</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>e_entry</code>存放了程序入口点的链接地址</p>
</blockquote>
<p><strong>Exercise 6</strong> 在<code>BIOS</code>进入<code>boot loader</code>时和<code>boot loader</code>进入<code>kernel</code>时观察内存<code>0x100000</code>处8字节的值，为什么它们不同？第二次观察时加载的是什么？</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;在进入<code>boot loader</code>时为0，进入kernel时:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/8wx 0x100000</span><br><span class="line">0x100000:	0x1badb002	0x00000000	0xe4524ffe	0x7205c766</span><br><span class="line">0x100010:	0x34000004	0x2000b812	0x220f0011	0xc0200fd8</span><br></pre></td></tr></table></figure>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;在从<code>boot loader</code>进入<code>kernel</code>时加载了<code>kernel</code>的第一页。前三个字段的含义可从<a target="_blank" rel="noopener" href="https://www.gnu.org/software/grub/manual/multiboot/html_node/Header-magic-fields.html">这里</a>查阅到，所有的<code>OS image</code>文件都会有这个文件头。</p>
<h1 id="Part3-The-Kernel"><a href="#Part3-The-Kernel" class="headerlink" title="Part3: The Kernel"></a>Part3: The Kernel</h1><h2 id="Using-virtual-memory-to-work-around-position-dependence"><a href="#Using-virtual-memory-to-work-around-position-dependence" class="headerlink" title="Using virtual memory to work around position dependence"></a>Using virtual memory to work around position dependence</h2><p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;由<code>objdump -h</code>输出结果得知<code>boot loader</code>的链接和加载地址相同，内核的不同。许多机器没有<code>0xf0100000</code>这么高的地址，我们要将处理器的内存管理硬件从虚拟地址<code>0xf0100000</code>映射到物理地址<code>0x100000</code>处（<code>kernel</code>实际被加载的地址）。链接内核比<code>boot loader</code>更复杂，所以内核的链接和加载地址在<code>kern/kernel.ld</code>的顶部【啥因果关系】。操作系统内核通常更倾向于链接并运行在较高的虚拟地址，将处理器的低地址留给用户程序使用。</p>
<p><strong>Exercise 7.</strong> 在切换到保护模式前观察内存<code>0x00100000</code>和<code>0xf0100000</code>处的值，单步运行一步，观察发生了什么？如果新的映射建立不正确，此后第一条出错的指令是什么？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">=&gt; 0x100025:	mov    %eax,%cr0</span><br><span class="line">0x00100025 in ?? ()</span><br><span class="line">(gdb) x/8wx 0x100000</span><br><span class="line">0x100000:	0x1badb002	0x00000000	0xe4524ffe	0x7205c766</span><br><span class="line">0x100010:	0x34000004	0x2000b812	0x220f0011	0xc0200fd8</span><br><span class="line">(gdb) x/8wx 0xf0100000</span><br><span class="line">0xf0100000 &lt;_start-268435468&gt;:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xf0100010 &lt;entry+4&gt;:	0x00000000	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<p>执行后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) si</span><br><span class="line">=&gt; 0x100028:	mov    $0xf010002f,%eax</span><br><span class="line">0x00100028 in ?? ()</span><br><span class="line">(gdb) x/8wx 0xf0100000</span><br><span class="line">0xf0100000 &lt;_start-268435468&gt;:	0x1badb002	0x00000000	0xe4524ffe	0x7205c766</span><br><span class="line">0xf0100010 &lt;entry+4&gt;:	0x34000004	0x2000b812	0x220f0011	0xc0200fd8</span><br><span class="line">(gdb) </span><br></pre></td></tr></table></figure>

<p>第一条出错感觉这句吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f0100028:	b8 2f 00 10 f0       	mov    $0xf010002f,%eax</span><br><span class="line">	jmp	*%eax</span><br><span class="line">f010002d:	ff e0                	jmp    *%eax</span><br></pre></td></tr></table></figure>

<h3 id="Formatted-Printing-to-the-Console"><a href="#Formatted-Printing-to-the-Console" class="headerlink" title="Formatted Printing to the Console"></a>Formatted Printing to the Console</h3><p><strong>Exercise 8</strong> 补全8进制输出代码</p>
<p>类比16进制写。可变长度参数函数<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/c/variadic">参考</a></p>
<ul>
<li>Explain the following from console.c:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 实现了滚屏功能 */</span></span><br><span class="line"><span class="number">1</span>      <span class="keyword">if</span> (crt_pos &gt;= CRT_SIZE) &#123;</span><br><span class="line"><span class="number">2</span>              <span class="type">int</span> i;</span><br><span class="line"><span class="number">3</span>              memmove(crt_buf, crt_buf + CRT_COLS, (CRT_SIZE - CRT_COLS) * <span class="keyword">sizeof</span>(<span class="type">uint16_t</span>));<span class="comment">// 将第二行至结尾的字符移动到第一行至倒数第二行</span></span><br><span class="line"><span class="number">4</span>              <span class="keyword">for</span> (i = CRT_SIZE - CRT_COLS; i &lt; CRT_SIZE; i++)</span><br><span class="line"><span class="number">5</span>                      crt_buf[i] = <span class="number">0x0700</span> | <span class="string">&#x27; &#x27;</span>;<span class="comment">// 最后一行输出空格，前背景色没查到</span></span><br><span class="line"><span class="number">6</span>              crt_pos -= CRT_COLS;</span><br><span class="line"><span class="number">7</span>      &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>crt_pos</code>:<code>current position</code>表示了当前光标位置</p>
<p><code>CRT_SIZE</code>:显示屏最大字符数，宽×高</p>
<p><code>crt_buf</code>：16位无符号整数数组，存储显示屏所有字符的ASCII码和显示属性。</p>
</blockquote>
<ul>
<li>调试，回答问题</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">1</span>, y = <span class="number">3</span>, z = <span class="number">4</span>;</span><br><span class="line">cprintf(<span class="string">&quot;x %d, y %x, z %d\n&quot;</span>, x, y, z);</span><br></pre></td></tr></table></figure>

<p>1.In the call to <code>cprintf()</code>, to what does <code>fmt</code> point? To what does <code>ap</code> point?</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;这个地方发现如果只跟到<code>cprintf</code>第一句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p <span class="built_in">fmt</span></span><br><span class="line"><span class="variable">$1</span> = 0xf0101c52 <span class="string">&quot;x %d, y %x, z %d\n&quot;</span></span><br><span class="line">pwndbg&gt; p ap</span><br><span class="line">No symbol <span class="string">&quot;ap&quot;</span> <span class="keyword">in</span> current context.</span><br></pre></td></tr></table></figure>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;<code>ap</code>的值看不到，不懂为啥。跟到<code>cprintf</code>调用的<code>vcprintf</code>第一句才看到正确的指向如下。<code>fmt</code>指向模板字符串地址，<code>ap</code>指向参数列表地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p <span class="built_in">fmt</span></span><br><span class="line"><span class="variable">$4</span> = 0xf0101c52 <span class="string">&quot;x %d, y %x, z %d\n&quot;</span></span><br><span class="line">pwndbg&gt; p ap</span><br><span class="line"><span class="variable">$5</span> = (va_list) 0xf0110fd4 <span class="string">&quot;\001&quot;</span></span><br><span class="line">pwndbg&gt; x/3wx ap</span><br><span class="line">0xf0110fd4:     0x00000001      0x00000003      0x00000004</span><br><span class="line">pwndbg&gt; </span><br></pre></td></tr></table></figure>

<p>6.Let’s say that GCC changed its calling convention so that it pushed arguments on the stack in declaration order, so that the last argument is pushed last. How would you have to change <code>cprintf</code> or its interface so that it would still be possible to pass it a variable number of arguments?</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &ensp;不太懂想问啥</p>
<h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><p><code>backtrace</code>：回溯，嵌套调用call的过程中保存下来的IP指针的值集合</p>
<p><strong>Exercise 9.</strong> 找出内核初始化栈的位置，栈的位置。内核是如何为栈保留空间的？栈指针最初指向这块区域的哪一端？</p>
<p>​          在<code>kern/entry.S</code>中的这两句初始化了栈。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">f010002f &lt;relocated&gt;:</span><br><span class="line">relocated:</span><br><span class="line"></span><br><span class="line">	# Clear the frame pointer register (EBP)</span><br><span class="line">	# so that once we get into debugging C code,</span><br><span class="line">	# stack backtraces will be terminated properly.</span><br><span class="line">	movl	$0x0,%ebp			# nuke frame pointer</span><br><span class="line">f010002f:	bd 00 00 00 00       	mov    $0x0,%ebp</span><br><span class="line"></span><br><span class="line">	# Set the stack pointer</span><br><span class="line">	movl	$(bootstacktop),%esp</span><br><span class="line">f0100034:	bc 00 00 11 f0       	mov    $0xf0110000,%esp</span><br><span class="line"></span><br><span class="line">	# now to C code</span><br><span class="line">	call	i386_init</span><br><span class="line">f0100039:	e8 6c 00 00 00       	call   f01000aa &lt;i386_init&gt;</span><br></pre></td></tr></table></figure>

<p>​      文档提示，由于编译器优化，在 <code>mon_backtrace()</code>序言前调用<code>read_ebp</code>会导致不完整的栈回溯，需要保证调用<code>read_ebp</code>发生在<code>mon_backtrace</code>之后。</p>
<p>【为啥直接调函数会优化】</p>
<p><strong>Exercise 12.</strong> 改进回溯函数，打印文件名、函数名、源文件行数、<code>eip</code>相对函数地址的偏移。</p>
<p>【为啥填的是<code>n_desc</code>成员】</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#Extended-Asm">带有C表达式操作数的AT&amp;T语法</a>或<a target="_blank" rel="noopener" href="http://neuraldk.org/document.php?att_asm">介个</a></p>
<p><a target="_blank" rel="noopener" href="http://www.osdever.net/FreeVGA/home.htm">我死活读不懂的VGA文档</a></p>
<p>CSAPP链接</p>
<p><del>这个<code>lab</code>真是做得费劲死了</del></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/os/" rel="tag"># os</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/27/malloclab/" rel="prev" title="csapp-malloclab">
      <i class="fa fa-chevron-left"></i> csapp-malloclab
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/10/02/windows-setup/" rel="next" title="Windows LTSC系统安装">
      Windows LTSC系统安装 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container" style="background-color: rgba(255,255,255,0.6);"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Part-1-PC-Bootstrap"><span class="nav-number">1.</span> <span class="nav-text">Part 1: PC Bootstrap</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-PC%E2%80%99s-Physical-Address-Space"><span class="nav-number">1.1.</span> <span class="nav-text">The PC’s Physical Address Space</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Part2-The-Boot-Loader"><span class="nav-number">2.</span> <span class="nav-text">Part2: The Boot Loader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Loading-the-Kernel"><span class="nav-number">2.1.</span> <span class="nav-text">Loading the Kernel</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Part3-The-Kernel"><span class="nav-number">3.</span> <span class="nav-text">Part3: The Kernel</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-virtual-memory-to-work-around-position-dependence"><span class="nav-number">3.1.</span> <span class="nav-text">Using virtual memory to work around position dependence</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Formatted-Printing-to-the-Console"><span class="nav-number">3.1.1.</span> <span class="nav-text">Formatted Printing to the Console</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Stack"><span class="nav-number">3.2.</span> <span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ling"
      src="/images/%E7%A9%B9.jpg">
  <p class="site-author-name" itemprop="name">ling</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ll1ng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ll1ng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/34082268" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;34082268" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://ll1ng.github.io/atom.xml" title="rss → https:&#x2F;&#x2F;ll1ng.github.io&#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>rss</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      小伙伴们>.<
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.wootec.top/" title="https:&#x2F;&#x2F;www.wootec.top&#x2F;" rel="noopener" target="_blank">Reverier</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://arttnba3.cn/" title="https:&#x2F;&#x2F;arttnba3.cn&#x2F;" rel="noopener" target="_blank">arttnba3</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://mercer5.github.io/" title="https:&#x2F;&#x2F;mercer5.github.io&#x2F;" rel="noopener" target="_blank">mercer</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yoursite.com/" title="http:&#x2F;&#x2F;yoursite.com" rel="noopener" target="_blank">...</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
    <!--music-->
    <div>
    
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1417637297&auto=0&height=66"></iframe>
      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ling</span>
</div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















    <div id="pjax">
  

  

<link rel="stylesheet" href="/css/gitalk.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('/js/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '0324b72a8577ea998218',
      clientSecret: '5e75c103ffafadd523fe6228fad280b3ec5a4972',
      repo        : 'comments',
      owner       : 'll1ng',
      admin       : ['ll1ng'],
      id          : '5fb8ba3476072b2365fcea140239b30a',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
